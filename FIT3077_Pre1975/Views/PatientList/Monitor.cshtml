@model FIT3077_Pre1975.Models.PatientsList
@{
    ViewData["Title"] = "Monitor List";
}
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.js" type="text/javascript"></script>

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.2.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
    var TeamDetailPostBackURL = 'ShowDetail';
    $(function () {
        $(".anchorDetail").click(function () {

            var $buttonClicked = $(this);
            var id = $buttonClicked.attr('data-id');
            var options = { "backdrop": "static", keyboard: true };
            $.ajax({
                type: "GET",
                url: TeamDetailPostBackURL,
                contentType: "application/json; charset=utf-8",
                data: { "Id": id },
                datatype: "json",
                success: function (data) {

                    $('#myModalContent').html(data);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');

                },
                error: function () {
                    alert("Dynamic content load failed.");
                }
            });
        });

        $("#closbtn").click(function () {
            $('#myModal').modal('hide');
        });
    });

</script>


<script>
    $(document).ready(function () {
        var total = 0;
        var rowCount = 0;
        $('td').each(function () {
            if ($(this).hasClass('patientvalue')) {
                var row = $(this).closest("tr")[0];
                total += parseFloat(row.cells[2].innerHTML.split()[0]);
                rowCount++;
            }
        });
        var average = total / rowCount;
        $("td").each(function () {
            if ($(this).hasClass('patientvalue')) {
                var row = $(this).closest("tr")[0];
                if (parseFloat(row.cells[2].innerHTML.split()[0]) > average) {
                    row.classList.add("highlight");
                }
            }
        });
    });
</script>


<div>
    <h4>Monitored Patients</h4>
    <hr />
    <table class="table" id="table">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Total Cholesterol</th>
                <th scope="col">Time</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Count > 0)
            {
                int count = 1;
                foreach (Patient patient in Model)
                {

                    <tr id=@patient.Id>
                        <td>@patient.Id</td>
                        <td>@patient.Name</td>
                        @if (patient.Observations.Count == 0)
                        {
                            <td>No Data</td>
                            <td>No Data</td>
                        }
                        else
                        {
                            <td class="patientvalue">@patient.Observations[0].MeasurementResult.Value @patient.Observations[0].MeasurementResult.Unit</td>
                            <td>@patient.Observations[0].Issued</td>
                        }
                        <td>
                            <a href="javascript:void(0);" class="anchorDetail" data-id="@patient.Id">Details</a>
                        </td>
                    </tr>

                    count++;
                }
            }
        </tbody>

    </table>
    <div id='myModal' class='modal'>
        <div class="modal-dialog">
            <div class="modal-content">
                <div id='myModalContent'></div>
            </div>
        </div>

    </div>
</div>

<style>
    .highlight {
        color: red;
        border-color: #1861ac;
    }
</style>
